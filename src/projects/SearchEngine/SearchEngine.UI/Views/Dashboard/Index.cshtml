@model SearchEngine.UI.Models.SearchViewModel
@{
    Layout = null; // Layout dosyasını iptal ediyoruz, her şey burada.
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Engine Dashboard</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        .search-card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); background: white; }
        .table-card { border: none; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); background: white; overflow: hidden; }
        .table thead th { background-color: #f1f3f5; color: #495057; font-weight: 600; border-bottom: none; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px; padding: 16px; }
        .table tbody td { padding: 16px; vertical-align: middle; border-bottom: 1px solid #f1f3f5; color: #212529; }
        .table tbody tr:last-child td { border-bottom: none; }
        .table tbody tr:hover { background-color: #f8f9fa; }
        .badge-custom { font-weight: 500; padding: 6px 12px; border-radius: 6px; }
        .badge-video { background-color: #fff0f0; color: #e03131; border: 1px solid #ffe3e3; }
        .badge-text { background-color: #e7f5ff; color: #1971c2; border: 1px solid #d0ebff; }
        .score-text { font-weight: 700; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div class="container py-5" style="max-width: 1000px;">
        
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-end mb-5">
            <div>
                <h1 class="fw-bold text-dark mb-1">Search Engine</h1>
                <p class="text-muted mb-0">Content Management Dashboard</p>
            </div>
            <form asp-action="Sync" method="post" onsubmit="return confirm('Sync data from providers?');">
                <button class="btn btn-dark rounded-pill px-4">
                    <i class="bi bi-arrow-clockwise me-2"></i>Sync Data
                </button>
            </form>
        </div>

        <!-- Alerts -->
        @if (ViewBag.Message != null)
        {
            <div class="alert alert-success border-0 shadow-sm mb-4">
                <i class="bi bi-check-circle-fill me-2"></i> @ViewBag.Message
            </div>
        }
        @if (ViewBag.Error != null)
        {
            <div class="alert alert-danger border-0 shadow-sm mb-4">
                <i class="bi bi-exclamation-triangle-fill me-2"></i> @ViewBag.Error
            </div>
        }

        <!-- Search Box -->
        <div class="search-card p-4 mb-5">
            <form method="get" asp-action="Index">
                <div class="row g-3">
                    <div class="col-md-5">
                        <label class="form-label small text-muted fw-bold">KEYWORD</label>
                        <input type="text" name="keyword" class="form-control form-control-lg bg-light border-0" placeholder="Search titles..." value="@Model.Keyword">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label small text-muted fw-bold">TYPE</label>
                        <select name="contentType" class="form-select form-select-lg bg-light border-0">
                            <option value="" selected="@(string.IsNullOrEmpty(Model.ContentType))">All</option>
                            <option value="Video" selected="@(Model.ContentType == "Video")">Video</option>
                            <option value="Text" selected="@(Model.ContentType == "Text")">Text</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                         <label class="form-label small text-muted fw-bold">SIZE</label>
                         <input type="number" name="pageSize" class="form-control form-control-lg bg-light border-0" value="@Model.PageSize" min="5" max="50">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary btn-lg w-100 border-0" style="background-color: #228be6;">Search</button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Results Table -->
        <div class="table-card">
            @if (Model.TotalCount > 0)
            {
                <div class="px-4 pt-4">
                    <span class="text-muted small">
                        Showing <strong>@(Model.From == 0 ? 1 : Model.From)</strong> - <strong>@Model.To</strong> of <strong>@Model.TotalCount</strong> results
                    </span>
                </div>
            }
            <table class="table mb-0">
                <thead>
                    <tr>
                        <th style="width: 60%;">Title</th>
                        <th style="width: 20%;">Type</th>
                        <th style="width: 20%;">Score</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Results != null && Model.Results.Any())
                    {
                        @foreach (var item in Model.Results)
                        {
                            <tr>
                                <td>
                                    <a href="@item.Url" target="_blank" class="text-decoration-none text-dark fw-semibold">@item.Title</a>
                                </td>
                                <td>
                                    @if (item.ContentType == Core.Domain.ComplexTypes.Enums.ContentType.Video)
                                    {
                                        <span class="badge-custom badge-video"><i class="bi bi-play-fill me-1"></i>Video</span>
                                    }
                                    else
                                    {
                                        <span class="badge-custom badge-text"><i class="bi bi-file-text me-1"></i>Text</span>
                                    }
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="score-text me-3" style="color: @(item.Score > 80 ? "#2f9e44" : "#1c7ed6");">@item.Score.ToString("0.0")</span>
                                        <div class="progress flex-grow-1" style="height: 4px; background-color: #e9ecef;">
                                            <div class="progress-bar" style="width: @Math.Min(item.Score, 100)%; background-color: @(item.Score > 80 ? "#40c057" : "#228be6");"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="3" class="text-center py-5 text-muted">
                                <i class="bi bi-inbox display-4 mb-3 d-block opacity-25"></i>
                                No results found
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            
            <!-- Pagination -->
            @if (Model.TotalPages > 1)
            {
                <div class="p-4 border-top bg-light d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
                    <div class="text-muted small">
                        Page <strong>@(Model.PageIndex + 1)</strong> of <strong>@Model.TotalPages</strong>
                    </div>
                    <nav aria-label="Pagination">
                        <ul class="pagination pagination-sm mb-0">
                            <li class="page-item @(Model.PageIndex == 0 ? "disabled" : "")">
                                <a class="page-link" href="@Url.Action("Index", new { pageIndex = Math.Max(0, Model.PageIndex - 1), keyword = Model.Keyword, contentType = Model.ContentType, pageSize = Model.PageSize })">
                                    Prev
                                </a>
                            </li>
                            @{
                                var start = Math.Max(0, Model.PageIndex - 2);
                                var end = Math.Min(Model.TotalPages - 1, Model.PageIndex + 2);
                            }
                            @if (start > 0)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { pageIndex = 0, keyword = Model.Keyword, contentType = Model.ContentType, pageSize = Model.PageSize })">1</a>
                                </li>
                                if (start > 1)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                            }
                            @for (var i = start; i <= end; i++)
                            {
                                <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new { pageIndex = i, keyword = Model.Keyword, contentType = Model.ContentType, pageSize = Model.PageSize })">
                                        @(i + 1)
                                    </a>
                                </li>
                            }
                            @if (end < Model.TotalPages - 1)
                            {
                                if (end < Model.TotalPages - 2)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { pageIndex = Model.TotalPages - 1, keyword = Model.Keyword, contentType = Model.ContentType, pageSize = Model.PageSize })">@Model.TotalPages</a>
                                </li>
                            }
                            <li class="page-item @(Model.PageIndex >= Model.TotalPages - 1 ? "disabled" : "")">
                                <a class="page-link" href="@Url.Action("Index", new { pageIndex = Math.Min(Model.TotalPages - 1, Model.PageIndex + 1), keyword = Model.Keyword, contentType = Model.ContentType, pageSize = Model.PageSize })">
                                    Next
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            }
        </div>

    </div>

</body>
</html>
